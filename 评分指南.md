# SpreadsheetBench è¯„åˆ†æ“ä½œæŒ‡å— (Windows PowerShell)

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. âœ… å·²å®Œæˆæ¨ç†æ­¥éª¤ (è¿è¡Œ `inference_single.ps1`)
2. âœ… åœ¨ Windows ç¯å¢ƒ (è¯„ä¼°éœ€è¦ä½¿ç”¨ `win32com` åº“)
3. âœ… å·²æ¿€æ´» Python ç¯å¢ƒ (conda base)

## ğŸš€ è¯„åˆ†æ­¥éª¤

### æ­¥éª¤ 1: éªŒè¯æ¨ç†è¾“å‡º

æ£€æŸ¥æ¨ç†æ˜¯å¦æˆåŠŸç”Ÿæˆäº†è¾“å‡ºæ–‡ä»¶:

```powershell
# æŸ¥çœ‹è¾“å‡ºç›®å½•
ls ..\data\test1\outputs\single_glm-4-flash\
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„æ–‡ä»¶:
- `1_59196_output.xlsx`
- `2_59196_output.xlsx`
- `3_59196_output.xlsx`

### æ­¥éª¤ 2: è¿›å…¥è¯„ä¼°ç›®å½•

```powershell
cd evaluation
```

### æ­¥éª¤ 3: è¿è¡Œè¯„ä¼°è„šæœ¬

```powershell
.\scripts\evaluation.ps1
```

### æ­¥éª¤ 4: æŸ¥çœ‹è¯„ä¼°ç»“æœ

```powershell
# æŸ¥çœ‹ JSON æ ¼å¼çš„è¯„ä¼°ç»“æœ
cat ..\outputs\eval_single_glm-4-flash.json
```

## ğŸ“Š è¯„åˆ†æŒ‡æ ‡è¯´æ˜

è¯„ä¼°è„šæœ¬ä¼šå¯¹æ¯ä¸ªé—®é¢˜çš„æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹è¿›è¡Œè¯„åˆ†,ç”Ÿæˆä¸¤ç§æŒ‡æ ‡:

### 1. Soft Restriction (è½¯çº¦æŸ)
- **è®¡ç®—æ–¹å¼**: é€šè¿‡çš„æµ‹è¯•æ¡ˆä¾‹æ•° / æ€»æµ‹è¯•æ¡ˆä¾‹æ•°
- **å–å€¼èŒƒå›´**: 0.0 - 1.0
- **ç¤ºä¾‹**: å¦‚æœ 3 ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¸­æœ‰ 2 ä¸ªé€šè¿‡,åˆ™ soft_restriction = 2/3 = 0.67

### 2. Hard Restriction (ç¡¬çº¦æŸ)
- **è®¡ç®—æ–¹å¼**: æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹éƒ½é€šè¿‡æ‰å¾— 1 åˆ†
- **å–å€¼èŒƒå›´**: 0 æˆ– 1
- **ç¤ºä¾‹**: 
  - 3 ä¸ªæµ‹è¯•æ¡ˆä¾‹å…¨éƒ¨é€šè¿‡ â†’ hard_restriction = 1
  - 3 ä¸ªæµ‹è¯•æ¡ˆä¾‹æœ‰ä»»ä½•ä¸€ä¸ªå¤±è´¥ â†’ hard_restriction = 0

## ğŸ“„ ç»“æœæ–‡ä»¶æ ¼å¼

```json
[
    {
        "id": 59196,
        "instruction_type": "Cell-Level Manipulation",
        "test_case_results": [1, 1, 0],    // ç¬¬1ã€2ä¸ªæµ‹è¯•é€šè¿‡,ç¬¬3ä¸ªå¤±è´¥
        "soft_restriction": 0.67,          // 66.7% é€šè¿‡ç‡
        "hard_restriction": 0              // æœªå…¨éƒ¨é€šè¿‡
    },
    {
        "id": 12345,
        "instruction_type": "Sheet-Level Manipulation",
        "test_case_results": [1, 1, 1],    // å…¨éƒ¨æµ‹è¯•é€šè¿‡
        "soft_restriction": 1.0,           // 100% é€šè¿‡ç‡
        "hard_restriction": 1              // å…¨éƒ¨é€šè¿‡
    }
]
```

## ğŸ”§ ä¿®æ”¹è¯„ä¼°å‚æ•°

ç¼–è¾‘ `evaluation/scripts/evaluation.ps1`:

```powershell
python evaluation.py `
    --setting single `              # è¯„ä¼°è®¾ç½®
    --model glm-4-flash `           # æ¨¡å‹åç§° (å¿…é¡»ä¸æ¨ç†æ—¶ä¸€è‡´!)
    --dataset test1                 # æ•°æ®é›†åç§°
```

### å‚æ•°è¯´æ˜

| å‚æ•° | å¯é€‰å€¼ | è¯´æ˜ |
|------|--------|------|
| `--setting` | `single` | å•è½®æ¨ç† |
|             | `multi_react_exec` | å¤šè½® (ReAct + æ‰§è¡Œåé¦ˆ) |
|             | `multi_row_exec` | å¤šè½® (æ‰§è¡Œåé¦ˆ + 5è¡Œ) |
|             | `multi_row_react_exec` | å¤šè½® (ReAct + æ‰§è¡Œåé¦ˆ + 5è¡Œ) |
| `--model` | ä»»æ„å­—ç¬¦ä¸² | å¿…é¡»ä¸æ¨ç†æ—¶ä½¿ç”¨çš„æ¨¡å‹åç§°å®Œå…¨ä¸€è‡´ |
| `--dataset` | `test1` | æµ‹è¯•æ•°æ®é›† (1ä¸ªé—®é¢˜) |
|             | `sample_data_200` | æ ·æœ¬æ•°æ®é›† (200ä¸ªé—®é¢˜) |
|             | `all_data_912_v0.1` | å®Œæ•´æ•°æ®é›† (912ä¸ªé—®é¢˜) |

## ğŸ¯ è¯„ä¼°åŸç†

è¯„ä¼°è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ:

1. **åŠ è½½æ•°æ®é›†**: è¯»å– `data/{dataset}/dataset.json`
2. **éå†æ¯ä¸ªé—®é¢˜**: 
   - å¯¹äºæ¯ä¸ªé—®é¢˜,æœ‰ 3 ä¸ªæµ‹è¯•æ¡ˆä¾‹ (test case 1, 2, 3)
   - æ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹åŒ…å«: è¾“å…¥æ–‡ä»¶ (`*_input.xlsx`) å’Œæ ‡å‡†ç­”æ¡ˆ (`*_answer.xlsx`)
3. **æ¯”è¾ƒè¾“å‡ºä¸ç­”æ¡ˆ**:
   - è¯»å–æ¨¡å‹ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶: `data/{dataset}/outputs/single_{model}/*_output.xlsx`
   - è¯»å–æ ‡å‡†ç­”æ¡ˆæ–‡ä»¶: `data/{dataset}/spreadsheet/{id}/*_answer.xlsx`
   - æ ¹æ® `answer_position` å­—æ®µ,æ¯”è¾ƒæŒ‡å®šå•å…ƒæ ¼çš„å€¼
4. **è®¡ç®—åˆ†æ•°**: 
   - å•å…ƒæ ¼å€¼å®Œå…¨åŒ¹é… â†’ è¯¥æµ‹è¯•æ¡ˆä¾‹é€šè¿‡ (1)
   - å•å…ƒæ ¼å€¼ä¸åŒ¹é…æˆ–æ–‡ä»¶ä¸å­˜åœ¨ â†’ è¯¥æµ‹è¯•æ¡ˆä¾‹å¤±è´¥ (0)
5. **ä¿å­˜ç»“æœ**: å°†è¯„ä¼°ç»“æœå†™å…¥ `outputs/eval_{setting}_{model}.json`

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: FileNotFoundError: output.xlsx

**åŸå› **: æ¨ç†æ­¥éª¤æ²¡æœ‰æˆåŠŸç”Ÿæˆè¾“å‡ºæ–‡ä»¶

**è§£å†³**: é‡æ–°è¿è¡Œæ¨ç†è„šæœ¬
```powershell
cd ..\inference
.\scripts\inference_single.ps1
```

### é—®é¢˜ 2: æ¨¡å‹åç§°ä¸åŒ¹é…

**åŸå› **: è¯„ä¼°æ—¶ä½¿ç”¨çš„æ¨¡å‹åç§°ä¸æ¨ç†æ—¶ä¸ä¸€è‡´

**è§£å†³**: ç¡®ä¿ `evaluation.ps1` ä¸­çš„ `--model` å‚æ•°ä¸ `inference_single.ps1` ä¸­çš„ `--model` å®Œå…¨ç›¸åŒ

### é—®é¢˜ 3: æ‰€æœ‰æµ‹è¯•éƒ½å¤±è´¥ (0åˆ†)

**å¯èƒ½åŸå› **:
1. ä»£ç æ‰§è¡Œç¯å¢ƒæœªå¯åŠ¨ (Docker)
2. ç”Ÿæˆçš„ä»£ç æœ‰è¯­æ³•é”™è¯¯
3. å•å…ƒæ ¼ä½ç½®è®¡ç®—é”™è¯¯

**è°ƒè¯•æ–¹æ³•**:
```powershell
# æŸ¥çœ‹å¯¹è¯è®°å½•,æ£€æŸ¥ç”Ÿæˆçš„ä»£ç 
cat ..\data\test1\outputs\conv_single_glm-4-flash.jsonl
```

## ğŸ“ˆ è®¡ç®—æ•´ä½“æ€§èƒ½

è¯„ä¼°å®Œæˆå,å¯ä»¥ä½¿ç”¨ Python è®¡ç®—æ•´ä½“æŒ‡æ ‡:

```python
import json

# è¯»å–è¯„ä¼°ç»“æœ
with open('../outputs/eval_single_glm-4-flash.json', 'r') as f:
    results = json.load(f)

# è®¡ç®—å¹³å‡åˆ†æ•°
avg_soft = sum(r['soft_restriction'] for r in results) / len(results)
avg_hard = sum(r['hard_restriction'] for r in results) / len(results)

print(f"Soft Restriction (å¹³å‡é€šè¿‡ç‡): {avg_soft:.2%}")
print(f"Hard Restriction (å®Œå…¨æ­£ç¡®ç‡): {avg_hard:.2%}")
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

```powershell
# 1. å¯åŠ¨ä»£ç æ‰§è¡Œç¯å¢ƒ (ä»…é¦–æ¬¡éœ€è¦)
cd code_exec_docker
bash start_jupyter_server.sh 8080

# 2. è¿è¡Œæ¨ç†
cd ..\inference
.\scripts\inference_single.ps1

# 3. è¿è¡Œè¯„ä¼°
cd ..\evaluation
.\scripts\evaluation.ps1

# 4. æŸ¥çœ‹ç»“æœ
cat ..\outputs\eval_single_glm-4-flash.json
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. âš ï¸ **Windows ç‹¬å **: è¯„ä¼°åªèƒ½åœ¨ Windows ç¯å¢ƒè¿è¡Œ
2. âš ï¸ **åç§°ä¸€è‡´æ€§**: ç¡®ä¿æ¨ç†å’Œè¯„ä¼°ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹åç§°
3. âš ï¸ **æ–‡ä»¶å®Œæ•´æ€§**: ç¡®ä¿æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹çš„è¾“å‡ºæ–‡ä»¶éƒ½å·²ç”Ÿæˆ
4. âœ… **æ‰¹é‡è¯„ä¼°**: å¯ä»¥å¯¹å¤šä¸ªæ¨¡å‹ä¾æ¬¡è¿›è¡Œè¯„ä¼°,åªéœ€ä¿®æ”¹ `--model` å‚æ•°
